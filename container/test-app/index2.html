<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta charset="utf-8" />

  <title>Just a Button... and a micro frontend!</title>

  <script src="https://unpkg.com/@ui5/webcomponents/dist/Button?module" type="module"></script>

  <!-- <script src="https://unpkg.com/@luigi-project/container" type="module"></script> -->
  <script src="./bundle.js" type="module"></script>
  <style>
    .flexCnt {
      display: flex;
    }

    .flexCnt>div {
      flex: 1;
    }
  </style>
</head>

<body>
  <div class="flexCnt">
    <div id="col1">
      <ui5-button>Send random string</ui5-button>
      <luigi-container webcomponent="true" viewUrl="https://luigiwebcomponents.gitlab.io/layouts/panelHeader.js">
      </luigi-container>
    </div>
    <div id="col2">
      <ui5-button>Send update</ui5-button>
      <luigi-container viewUrl="./microfrontend.html"> </luigi-container>
    </div>
  </div>

  <script type="module">
    import Events from './bundle.js'

    // Some glue code
    const btn1 = document.querySelector('#col1 ui5-button');
    const luigiCnt1 = document.querySelector('#col1 luigi-container');
    const btn2 = document.querySelector('#col2 ui5-button');
    const luigiCnt2 = document.querySelector('#col2 luigi-container');

    btn1.addEventListener('click', () => {
      luigiCnt1.sendCustomMessage('update', 'data ' + new Date().getMilliseconds());
    });

    btn2.addEventListener('click', () => {
      luigiCnt2.sendCustomMessage('update');
    });

    luigiCnt2.addEventListener(Events.NAVIGATION_REQUEST, event => {
      if (confirm('Do you want to leave this page?')) {
        window.location = event.detail.link;
      }
    });

    luigiCnt2.addEventListener(Events.CUSTOM_MESSAGE, event => {
      alert('Custom message recieved: ' + JSON.stringify(event.detail));
    });

    // luigiCnt2.addEventListener(Events.ALERT_REQUEST, event => {
    //   console.log('luigi.ux.alert.show message recieved: ' + JSON.stringify(event.detail));
    //   // some code to manipulate DOM to add some alert box at the top
    //   // >>>>> Code here <<<<<

    //   // tell the Client that alert was shown. 
    //   event.alertShown();
    // });

    const showAnAlert = () => {
      var popup = document.createElement("div");
      var text = document.createTextNode("blah blah blah");
      popup.appendChild(text);

      var dismissButton = document.createElement('BUTTON');
      var buttonText = document.createTextNode("Close Alert");
      dismissButton.addEventListener('click', () => {
        console.log('Dismiss clicked outside');
      })
      dismissButton.appendChild(buttonText);
      popup.appendChild(dismissButton);

      popup.style.visibility = "visible";
      popup.id = "pop";
      document.getElementsByTagName("body")[0].appendChild(popup);
      return dismissButton;
    }

    luigiCnt2.addAlertListener(showAnAlert, { data: 'some stuff' });

    // TODO: initial
    luigiCnt2.addEventListener(Events.GET_CONTEXT_REQUEST, event => {
      const dataToSend = {
        someDataToSend: 'The year is 2023'
      }
      console.log('Data being sent from Core -> MF', dataToSend)
      event.sendContextToMicrofrontend(dataToSend);
    });

    // TODO: initial
    // updateContext case
    luigiCnt2.updateContext({ someData: '' });


    // addEventListener(Events.GET_CONTEXT_REQUEST, event => {
    //   const dataToSend = {
    //     someDataToSend: 'The year is 2023'
    //   }
    //   console.log('Data being sent from Core -> MF', dataToSend)
    //   event.sendContextToMicrofrontend(dataToSend);
    // });

    // luigiCnt2.sendContextToMicrofrontend();

    luigiCnt2.addEventListener(Events.ADD_SEARCH_PARAMS_REQUEST, event => {
      console.log(event);
      alert('add-search-params-request message recieved: ' + JSON.stringify(event.detail));
    });


    luigiCnt2.addEventListener(Events.ADD_NODE_PARAMS_REQUEST, event => {
      console.log(event);
      alert('add-node-params-request message recieved: ' + JSON.stringify(event.detail));
    });


    luigiCnt2.addEventListener(Events.SHOW_CONFIRMATION_MODAL_REQUEST, event => {
      console.log(event);
      alert('show-confirmation-modal message recieved: ' + JSON.stringify(event.detail));
    });

    luigiCnt2.addEventListener(Events.SHOW_LOADING_INDICATOR_REQUEST, event => {
      console.log(event);
      alert('show-loading-indicator-request message recieved: ' + JSON.stringify(event));
    });

    luigiCnt2.addEventListener(Events.HIDE_LOADING_INDICATOR_REQUEST, event => {
      console.log(event);
      alert('hide-loading-indicator-request message recieved: ' + JSON.stringify(event));
    });
  </script>
</body>

</html>