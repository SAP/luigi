<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <title>Luigi MFE Container</title>

    <link rel="icon" type="image/png" href="./favicon.png" />
    <link rel="stylesheet" href="./global.css" />

    <script type="module">
      import './bundle.js';
      import MFEventID from './bundle.js';
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./services/mini-router.js"></script>
  </head>

  <body>
    <!-- This example requires Tailwind CSS v2.0+ -->
    <nav class="bg-gray-800">
      <div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8">
        <div class="relative flex items-center justify-between h-16">
          <div class="absolute inset-y-0 left-0 flex items-center sm:hidden">
            <!-- Mobile menu button-->
            <button
              type="button"
              class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"
              aria-controls="mobile-menu"
              aria-expanded="false"
              onclick="event.stopPropagation(); document.querySelector('#mobile-menu').classList.toggle('hidden')"
            >
              <span class="sr-only">Open main menu</span>
              <!--
			  Icon when menu is closed.
  
			  Heroicon name: outline/menu
  
			  Menu open: "hidden", Menu closed: "block"
			-->
              <svg
                class="block h-6 w-6"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"
                />
              </svg>
              <!--
			  Icon when menu is open.
  
			  Heroicon name: outline/x
  
			  Menu open: "block", Menu closed: "hidden"
			-->
              <svg
                class="hidden h-6 w-6"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
            </button>
          </div>
          <div
            class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start"
          >
            <div class="flex-shrink-0 flex items-center">
              <img
                class="block lg:hidden h-8 w-auto"
                src="https://tailwindui.com/img/logos/workflow-mark-indigo-500.svg"
                alt="Workflow"
              />
              <img
                class="hidden lg:block h-8 w-auto"
                src="https://tailwindui.com/img/logos/workflow-logo-indigo-500-mark-white-text.svg"
                alt="Workflow"
              />
            </div>
            <div class="hidden sm:block sm:ml-6">
              <div class="flex space-x-4" top-navigation>
                <!-- Current: "bg-gray-900 text-white", Default: "text-gray-300 hover:bg-gray-700 hover:text-white" -->
                <a
                  href="#dashboard"
                  class="bg-gray-900 text-white px-3 py-2 rounded-md text-sm font-medium"
                  >Dashboard</a
                >

                <a
                  href="#dashboard2"
                  class="bg-gray-900 text-white px-3 py-2 rounded-md text-sm font-medium"
                  >Dashboard2</a
                >

                <a
                  href="#team"
                  class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium"
                  >Team</a
                >

                <a
                  href="#projects"
                  class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium"
                  >Projects</a
                >

                <a
                  href="#calendar"
                  class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium"
                  >Calendar</a
                >
                <a
                  href="#test"
                  class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium"
                  >Test</a
                >
                <a
                  href="#test2"
                  class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium"
                  >Test2</a
                >
                <a
                  href="#hello-world-wc"
                  class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium"
                  >Simple Web Component</a
                >
                <a
                  href="#error-handling"
                  class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium"
                  >Err</a
                >
              </div>
            </div>
          </div>
          <div
            class="absolute inset-y-0 right-0 flex items-center pr-2 sm:static sm:inset-auto sm:ml-6 sm:pr-0"
          >
            <button
              type="button"
              class="bg-gray-800 p-1 rounded-full text-gray-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white"
              onclick="window.location.href = '/index2.html'"
            >
              <span class="sr-only">View notifications</span>
              <!-- Heroicon name: outline/bell -->
              <svg
                class="h-6 w-6"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                aria-hidden="true"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                />
              </svg>
            </button>

            <!-- Profile dropdown -->
            <div class="ml-3 relative">
              <div>
                <button
                  type="button"
                  class="bg-gray-800 flex text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white"
                  id="user-menu-button"
                  aria-expanded="false"
                  aria-haspopup="true"
                >
                  <span class="sr-only">Open user menu</span>
                  <img
                    class="h-8 w-8 rounded-full"
                    src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                    alt=""
                  />
                </button>
              </div>

              <!--
			  Dropdown menu, show/hide based on menu state.
  
			  Entering: "transition ease-out duration-100"
				From: "transform opacity-0 scale-95"
				To: "transform opacity-100 scale-100"
			  Leaving: "transition ease-in duration-75"
				From: "transform opacity-100 scale-100"
				To: "transform opacity-0 scale-95"
			-->
              <div
                class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none"
                role="menu"
                aria-orientation="vertical"
                aria-labelledby="user-menu-button"
                tabindex="-1"
                style="display:none"
              >
                <!-- Active: "bg-gray-100", Not Active: "" -->
                <a
                  href="#"
                  class="block px-4 py-2 text-sm text-gray-700"
                  role="menuitem"
                  tabindex="-1"
                  id="user-menu-item-0"
                  >Your Profile</a
                >
                <a
                  href="#"
                  class="block px-4 py-2 text-sm text-gray-700"
                  role="menuitem"
                  tabindex="-1"
                  id="user-menu-item-1"
                  >Settings</a
                >
                <a
                  href="#"
                  class="block px-4 py-2 text-sm text-gray-700"
                  role="menuitem"
                  tabindex="-1"
                  id="user-menu-item-2"
                  >Sign out</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile menu, show/hide based on menu state. -->
      <div class="hidden" id="mobile-menu">
        <div class="px-2 pt-2 pb-3 space-y-1">
          <!-- Current: "bg-gray-900 text-white", Default: "text-gray-300 hover:bg-gray-700 hover:text-white" -->
          <a
            href="#dashboard"
            class="bg-gray-900 text-white block px-3 py-2 rounded-md text-base font-medium"
            aria-current="page"
            >Dashboard</a
          >

          <a
            href="#dashboard2"
            class="bg-gray-900 text-white block px-3 py-2 rounded-md text-base font-medium"
            aria-current="page"
            >Dashboard2</a
          >

          <a
            href="#team"
            class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium"
            >Team</a
          >

          <a
            href="#projects"
            class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium"
            >Projects</a
          >

          <a
            href="#calendar"
            class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium"
            >Calendar</a
          >
          <a
            href="#test"
            class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium"
            >Test</a
          >
          <a
            href="#hello-world-wc"
            class="text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium"
            >Simple Web Component</a
          >
        </div>
      </div>
    </nav>

    <!-- LUIGI Micro Frontends -->
    <div class="lui-wrapper" route="dashboard">
      <luigi-compound-container
        data-test-id="luigi-client-api-test-compound-01"
        id="dashboard"
        context='{"label": "Dashboard"}'
        node-params='{"Luigi":"rocks"}'
        search-params='{"test":"searchParam1"}'
        path-params='{"path":"param"}'
        client-permissions='{"permission": "testPermission"}'
        user-settings='{"language":"it", "date":""}'
        anchor="testAnchorCompound"
      ></luigi-compound-container>
    </div>
    <div class="lui-wrapper" route="dashboard2">
      <luigi-compound-container
        id="nested-wc-compound-container"
        context='{"label": "Dashboard2", "title":"Dashboard2"}'
        viewUrl="http://localhost:8080/nested.js"
        node-params='{"Das ist ein":"compound tets"}'
      ></luigi-compound-container>
    </div>
    <!-- viewUrl="http://localhost:8080/nested.js" -->
    <!-- https://luigiwebcomponents.gitlab.io/nested.js skip-init-check="true"-->
    <div class="lui-wrapper" route="team">
      <luigi-container
        viewURL="https://fiddle.luigi-project.io/examples/microfrontends/fundamental/table-demo-page.html"
        context='{"title": "Team", "content":""}'
      ></luigi-container>
    </div>
    <div class="lui-wrapper" route="projects">
      <luigi-container
        data-test-id="iframe-based-container-test"
        viewURL="./microfrontend.html"
        context='{"title": "Projects", "content":" "}'
      >
      </luigi-container>
    </div>
    <div class="lui-wrapper" route="calendar">
      <luigi-container
        viewURL="https://luigiwebcomponents.gitlab.io/luigiwebcomponentmf/main.js"
        webcomponent="true"
        context='{"label": "Calendar"}'
        id="calendar"
      ></luigi-container>
    </div>
    <div class="lui-wrapper" route="test">
      <luigi-container
        viewURL="/test.js"
        webcomponent="true"
        id="test-defer-init-false"
        skip-init-check
      ></luigi-container>
    </div>
    <div class="lui-wrapper" route="test2">
      <luigi-container
        viewURL="http://localhost:8080/test2.js"
        webcomponent="true"
        id="test-defer-init-true"
      ></luigi-container>
    </div>
    <div class="lui-wrapper" route="hello-world-wc">
      <luigi-container
        data-test-id="luigi-client-api-test-01"
        viewURL="./helloWorldWC.js"
        webcomponent="true"
        context='{"label": "Hello World WC", "title":"Hello World WC:  Testing Container Web Component Features"}'
        locale="en"
        theme="sap_fiori_3"
        active-feature-toggle-list='["ft1","ft2"]'
        node-params='{"Luigi":"rocks from attri &<strong>asdf<strong> bute"}'
        search-params='{"test":"searchParam1"}'
        path-params='{"path":"param"}'
        client-permissions='{"permission": "testPermission"}'
        user-settings='{"language": "de", "date":""}'
        anchor="testanchor"
      ></luigi-container>
    </div>
    <div class="lui-wrapper" route="error-test">
      <luigi-container
        viewURL="https://luigiwebcomponents.gitlab.io/luigiwebcomponentmf/mainasdad.js"
        webcomponent="true"
        context=' {"label": "Error Handler" }'
      ></luigi-container>
      <luigi-container
        viewURL="/test.js"
        webcomponent="true"
        context='{"label": "Error Handler WC 2"}'
      >
      </luigi-container>
    </div>

    <script type="module">
      var layoutMFEDomain = 'https://luigiwebcomponents.gitlab.io/layouts';
      var utilMFEDomain = 'https://luigiwebcomponents.gitlab.io/util';
      import MFEventID from './bundle.js';

      const lcc = document.getElementById('dashboard');
      lcc.addEventListener(MFEventID.CUSTOM_MESSAGE, e => {
        console.log('Publish Event', e.detail);
      });
      lcc.compoundConfig = {
        renderer: {
          use: 'grid',
          config: {
            columns: '1fr 1fr 1fr 2fr',
            /*rows: '150px',*/
            /*gap: '30px',*/
            layouts: [
              {
                minWidth: 0,
                maxWidth: 600,
                columns: '1fr',
                gap: 0
              },
              {
                minWidth: 600,
                maxWidth: 1024,
                columns: '1fr 1fr',
                gap: '30px'
              }
            ]
          }
        },
        children: [
          {
            viewUrl: layoutMFEDomain + '/panelHeader.js',
            context: {
              title: 'My Awesome Grid 000',
              description: 'Really awesome'
            },
            layoutConfig: {
              row: '1',
              column: '1 / -1'
            },
            eventListeners: [
              {
                source: 'input1',
                name: 'sendInput',
                action: 'update',
                dataConverter: data => {
                  return 'new text: ' + data;
                }
              }
            ]
          },
          {
            id: 'input1',
            viewUrl: '/helloWorldWC.js',
            context: {
              title: 'Some input',
              instant: true
            }
          },
          {
            viewUrl: 'https://luigiwebcomponents.gitlab.io/luigi-wc-mfe/main.js',
            context: {
              label: 'Another web component'
            }
          },
          {
            id: 'timerMFE',
            viewUrl: utilMFEDomain + '/timer.js',
            context: {
              min: 2,
              fontScale: '0.5'
            }
          },
          {
            viewUrl: 'https://luigiwebcomponents.gitlab.io/luigiwebcomponentmf/main.js',
            context: {
              label: 'UI5 Button'
            }
          },
          {
            viewUrl: 'https://luigiwebcomponents.gitlab.io/luigi-wc-mfe/main.js',
            context: {
              label: 'My Label'
            }
          },
          {
            viewUrl: layoutMFEDomain + '/panelFooter.js',
            context: {
              footer: 'This is the end of awesomeness'
            },
            layoutConfig: {
              column: '1 / -1'
            }
          }
        ]
      };

      document.getElementById('nested-wc-compound-container').compoundConfig = {
        children: [
          {
            viewUrl: layoutMFEDomain + '/panelHeader.js',
            context: {
              title: 'My Awesome Grid',
              description: 'Really awesome'
            },
            layoutConfig: {
              slot: 'header'
            },
            eventListeners: [
              {
                source: 'input1',
                name: 'sendInput',
                action: 'update',
                dataConverter: data => {
                  return 'new text: ' + data;
                }
              }
            ]
          },
          {
            viewUrl: 'https://luigiwebcomponents.gitlab.io/luigi-wc-mfe/main.js',
            context: {
              label: 'Another web component'
            },
            layoutConfig: {
              slot: 'content'
            }
          },
          {
            viewUrl: layoutMFEDomain + '/panelFooter.js',
            context: {
              footer: 'This is the end of awesomeness'
            },
            layoutConfig: {
              slot: 'footer'
            }
          }
        ]
      };

      [
        ...document.querySelectorAll('luigi-container'),
        ...document.querySelectorAll('luigi-compound-container')
      ].forEach(luigiContainer => {
        luigiContainer.addEventListener(MFEventID.NAVIGATION_REQUEST, event => {
          console.log(event.detail);
          window.location.hash = event.detail.link;
        });
        luigiContainer.addEventListener(MFEventID.ALERT_REQUEST, event => {
          console.log(event.detail);
          alert(event.detail.text);
        });
        luigiContainer.addEventListener(
          MFEventID.SHOW_CONFIRMATION_MODAL_REQUEST,
          event => {
            console.log(event.detail);
            const val = confirm(event.detail.body);
            // send back to mf alert.answer with data
            window.postMessage('alert.answer', data);
            event.luigiCallback(val);
          }
        );
        luigiContainer.addEventListener(MFEventID.CUSTOM_MESSAGE, event => {
          console.log('Custom Event', event);
          if (event.detail.id !== 'timer') {
            alert(event.detail.id);
          }
        });

        luigiContainer.addEventListener(
          MFEventID.RUNTIME_ERROR_HANDLING_REQUEST,
          event => {
            console.log(event.detail);
          }
        );
        luigiContainer.addEventListener(MFEventID.ADD_NODE_PARAMS_REQUEST, event => {
          const params = event.detail.params;
          console.log('params', params);
        });
        luigiContainer.addEventListener(MFEventID.SET_ANCHOR_LINK_REQUEST, event => {
          console.log('anhor', event.detail);
        });

        //...
      });
      let testDeferInitFalse = document.getElementById('test-defer-init-false');
      if (!testDeferInitFalse.initialized) {
        testDeferInitFalse.addEventListener(MFEventID.INITIALIZED, () => {
          console.log('mfe is ready now!');
        });
      } else {
        console.log('mfe immediately ready');
      }
      let testDeferInitTrue = document.getElementById('test-defer-init-true');
      if (!testDeferInitTrue.initialized) {
        testDeferInitTrue.addEventListener(MFEventID.INITIALIZED, () => {
          console.log('mfe is ready now! 2');
        });
      } else {
        console.log('mfe immediately ready 2');
      }
      let skipInitCheckCompoundCtn = document.getElementById(
        'nested-wc-compound-container'
      );
      if (!skipInitCheckCompoundCtn.initialized) {
        skipInitCheckCompoundCtn.addEventListener(MFEventID.INITIALIZED, () => {
          console.log('compoundTest is ready now!');
        });
      }
    </script>
  </body>
</html>
