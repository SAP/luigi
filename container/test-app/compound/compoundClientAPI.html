<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <script type="module">
      import '../bundle.js';
    </script>
    <style>
      html,
      body {
        margin: 10;
        margin-top: 20;
      }
    </style>
  </head>
  <body>
    <h3>
      This page is used to test Compound-Container Luigi CLient API functionalities for
      compound web component based microfrontend
    </h3>
    <button id="luigi-update-context" type="button">Update context</button>

    <!-- base scenario compound container-->
    <span>Below is a compound container example for testing functionality</span>
    <div style="border:solid 1px blue">
      <luigi-compound-container
        data-test-id="luigi-client-api-test-compound-01"
        id="dashboard"
        context='{"label": "Dashboard"}'
        node-params='{"Luigi":"rocks"}'
        search-params='{"test":"searchParam1"}'
        path-params='{"path":"param"}'
        client-permissions='{"permission": "testPermission"}'
        user-settings='{"language":"it", "date":""}'
        anchor="testAnchorCompound"
        defer-init="false"
        webcomponent="true"
      ></luigi-compound-container>
    </div>

    <!-- defer-init scenario wc container-->
    <button id="init-button" style="margin: 25px 0 10px;">
      container.init() - click to initialize defered compound wc
    </button>
    <div style="border:solid 1px red; height: 100px;">
      <luigi-compound-container
        id="defer-init-test"
        webcomponent="true"
        context='{"content":" -- defer-init test --"}'
        defer-init="true"
      ></luigi-compound-container>

      <!-- Used for testing dynamic compound container creation -->
      <div class="content"></div>
    </div>

    <script type="module">
      import MFEventID from '../bundle.js';

      const compoundContainer = document.getElementById('dashboard');
      compoundContainer.addEventListener(MFEventID.CUSTOM_MESSAGE, e => {
        console.log('Publish Event', e.detail);
      });
      compoundContainer.compoundConfig = {
        renderer: {
          use: 'grid',
          config: {
            columns: '1fr 1fr 1fr 2fr',
            layouts: [
              {
                minWidth: 0,
                maxWidth: 600,
                columns: '1fr',
                gap: 0
              },
              {
                minWidth: 600,
                maxWidth: 1024,
                columns: '1fr 1fr',
                gap: '30px'
              }
            ]
          }
        },
        children: [
          {
            viewUrl: 'https://luigiwebcomponents.gitlab.io/layouts/panelHeader.js',
            context: {
              title: 'My Awesome Grid 000',
              description: 'Really awesome'
            },
            layoutConfig: {
              row: '1',
              column: '1 / -1'
            },
            eventListeners: [
              {
                source: 'input1',
                name: 'sendInput',
                action: 'update',
                dataConverter: data => {
                  return 'new text: ' + data;
                }
              }
            ]
          },
          {
            id: 'input1',
            viewUrl: './compound/helloWorldWC.js',
            context: {
              title: 'Some input',
              instant: true
            }
          },
          {
            viewUrl: 'https://luigiwebcomponents.gitlab.io/luigi-wc-mfe/main.js',
            context: {
              label: 'Another web component'
            }
          },
          {
            id: 'timerMFE',
            viewUrl: 'https://luigiwebcomponents.gitlab.io/util/timer.js',
            context: {
              min: 2,
              fontScale: '0.5'
            }
          },
          {
            viewUrl: 'https://luigiwebcomponents.gitlab.io/luigi-wc-mfe/main.js',
            context: {
              label: 'My Label'
            }
          },
          {
            viewUrl: 'https://luigiwebcomponents.gitlab.io/layouts/panelFooter.js',
            context: {
              footer: 'This is the end of awesomeness'
            },
            layoutConfig: {
              column: '1 / -1'
            }
          }
        ]
      };

      compoundContainer.init();
      compoundContainer.addEventListener(MFEventID.NAVIGATION_REQUEST, event => {
        console.log(event.detail);
        window.location.hash = event.detail.link;
      });
      compoundContainer.addEventListener(MFEventID.ALERT_REQUEST, event => {
        console.log(event.detail);
        alert(event.detail.text);
      });
      compoundContainer.addEventListener(
        MFEventID.SHOW_CONFIRMATION_MODAL_REQUEST,
        event => {
          console.log(event.detail);
          const val = confirm(event.detail.body);
          // send back to mf alert.answer with data
          window.postMessage('alert.answer', data);
          event.luigiCallback(val);
        }
      );
      compoundContainer.addEventListener(MFEventID.CUSTOM_MESSAGE, event => {
        console.log('Custom Event', event);
        if (event.detail.id !== 'timer') {
          alert(event.detail.id);
        }
      });

      compoundContainer.addEventListener(
        MFEventID.RUNTIME_ERROR_HANDLING_REQUEST,
        event => {
          console.log(event.detail);
        }
      );
      compoundContainer.addEventListener(MFEventID.ADD_NODE_PARAMS_REQUEST, event => {
        const params = event.detail.params;
        console.log('params', params);
      });
      compoundContainer.addEventListener(MFEventID.SET_ANCHOR_LINK_REQUEST, event => {
        console.log('anchor', event.detail);
      });

      // uxManager(). closeUserSettings openUserSettings collapseLeftSideNav
      // setDocumentTitle removeBackdrop hideAppLoadingIndicator
      compoundContainer.addEventListener(MFEventID.CLOSE_USER_SETTINGS_REQUEST, event => {
        console.log('Close User Settings Request received', event.detail);
      });
      compoundContainer.addEventListener(MFEventID.OPEN_USER_SETTINGS_REQUEST, event => {
        console.log('Open User Settings Request received', event.detail);
      });
      compoundContainer.addEventListener(MFEventID.COLLAPSE_LEFT_NAV_REQUEST, event => {
        console.log('Collapse Left Side Nav Request received', event.detail);
      });
      compoundContainer.addEventListener(MFEventID.SET_DOCUMENT_TITLE_REQUEST, event => {
        console.log('Set Document Title Request received', event.detail);
      });
      compoundContainer.addEventListener(MFEventID.REMOVE_BACKDROP_REQUEST, event => {
        console.log('Remove Backdrop Request received', event.detail);
      });
      compoundContainer.addEventListener(
        MFEventID.HIDE_LOADING_INDICATOR_REQUEST,
        event => {
          console.log('Hide Loading Indicator Request received', event.detail);
        }
      );

      // linkManager listeners:
      // path exists
      compoundContainer.addEventListener(MFEventID.PATH_EXISTS_REQUEST, event => {
        console.log('Remove Backdrop Request received', event.detail, event);
        // send back result with defined 'callback'
        // event: MFEventID.PathExistsEvent can be used as an event type to get the callback function
        event.callback(true);
      });

      // setViewGroup Data listener
      compoundContainer.addEventListener(MFEventID.SET_VIEW_GROUP_DATA_REQUEST, event => {
        console.log('Set View Group Data Request received', event.detail, event);
        alert(JSON.stringify(event.detail));
      });

      const deferInitContainer = document.getElementById('defer-init-test');
      const initButton = document.getElementById('init-button');
      initButton.addEventListener('click', function() {
        deferInitContainer.init();
      });
      deferInitContainer.compoundConfig = {
        renderer: {
          use: 'grid',
          config: {
            columns: '1fr 1fr',
            gap: '20px'
          }
        },
        children: [
          {
            viewUrl: './compound/defer-init-wc/compoundWCDeferInit1.js'
          },
          {
            viewUrl: './compound/defer-init-wc/compoundWCDeferInit2.js'
          }
        ]
      };

      document.querySelector('#luigi-update-context').addEventListener('click', () => {
        compoundContainer.updateContext({ newContextData: 'some data' });
      });
    </script>
  </body>
</html>
