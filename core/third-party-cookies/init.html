<body>
  <script type="text/javascript">
    const winParent = window.parent;
    const targetOrigin = winParent.origin !== 'null' ? winParent.origin : '*';
    const luigiCookieValue = 'luigiCookie=true';
    const sanitizeCookies = cookies => {
      const charMap = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        '`': '&grave;',
        "'": '&#x27;',
        '/': '&#x2F;'
      };

      return cookies.replace(/[&<>"`'/]/ig, match => (charMap[match]));
    };
    const getLuigiCookie = cookies =>
      cookies
        .split(';')
        .map(cookie => cookie.trim())
        .find(cookie => cookie === luigiCookieValue);
    let cookies = sanitizeCookies(document.cookie);
    let tpc = 'enabled';
    let luigiCookie;
    let luigiCookieKey;

    if (cookies) {
      luigiCookie = getLuigiCookie(cookies);
    }
    if (luigiCookie === luigiCookieValue) {
      luigiCookieKey = luigiCookie.split('=')[0];
      document.cookie = luigiCookieKey + '=; Max-Age=-99999999; SameSite=None; Secure';
    }

    document.cookie = luigiCookieValue + '; SameSite=None; Secure';
    cookies = sanitizeCookies(document.cookie);

    if (cookies) {
      luigiCookie = getLuigiCookie(cookies);
    }
    if (luigiCookie === luigiCookieValue) {
      winParent.postMessage({ msg: 'luigi.third-party-cookie', tpc }, targetOrigin);
      document.cookie = luigiCookieKey + '=; Max-Age=-99999999; SameSite=None; Secure';
    } else {
      tpc = 'disabled';
      winParent.postMessage({ msg: 'luigi.third-party-cookie', tpc }, targetOrigin);
      console.warn('Third party cookies are not supported!');
    }
  </script>
</body>
