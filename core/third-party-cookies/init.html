<body>
  <script type="text/javascript" src="dompurify.min.js"></script>
  <script type="text/javascript">
    let tpc = 'enabled';
    let cookies = document.cookie;
    let luigiCookie;
    let luigiCookieKey;
    const winParent = window.parent;
    const targetOrigin = winParent.origin !== 'null' ? winParent.origin : '*';
    const getLuigiCookie = storedCookies => storedCookies
      .split(';')
      .map(cookie => DOMPurify.sanitize(cookie).trim())
      .find(cookie => cookie === 'luigiCookie=true');
    const setLuigiCookie = luigiCookie => {
      luigiCookieKey = luigiCookie.split('=')[0];
      document.cookie = luigiCookieKey + '=; Max-Age=-99999999; SameSite=None; Secure';
    };

    if (cookies) {
      luigiCookie = getLuigiCookie(cookies);
    }
    if (luigiCookie === 'luigiCookie=true') {
      setLuigiCookie(luigiCookie);
    }

    document.cookie = 'luigiCookie=true; SameSite=None; Secure';
    cookies = document.cookie;

    if (cookies) {
      luigiCookie = getLuigiCookie(cookies);
    }
    if (luigiCookie === 'luigiCookie=true') {
      winParent.postMessage({ msg: 'luigi.third-party-cookie', tpc }, targetOrigin);
      setLuigiCookie(luigiCookie);
    } else {
      tpc = 'disabled';
      winParent.postMessage({ msg: 'luigi.third-party-cookie', tpc }, targetOrigin);
      console.warn('Third party cookies are not supported!');
    }
  </script>
</body>
