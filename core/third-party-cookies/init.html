<body>
  <script type="text/javascript" src="dompurify.min.js"></script>
  <script type="text/javascript">
    let tpc = 'enabled';
    let cookies = document.cookie;
    let luigiCookie;
    let luigiCookieKey;
    const winParent = window.parent;
    const targetOrigin = winParent.origin !== 'null' ? winParent.origin : '*';
    const luigiCookieValue = 'luigiCookie=true';
    const getLuigiCookie = storedCookies =>
      storedCookies
        .split(';')
        .map(cookie => DOMPurify.sanitize(cookie).trim())
        .find(cookie => cookie === luigiCookieValue);

    if (cookies) {
      luigiCookie = getLuigiCookie(cookies);
    }
    if (luigiCookie === luigiCookieValue) {
      luigiCookieKey = luigiCookie.split('=')[0];
      document.cookie = luigiCookieKey + '=; Max-Age=-99999999; SameSite=None; Secure';
    }

    document.cookie = luigiCookieValue + '; SameSite=None; Secure';
    cookies = document.cookie;

    if (cookies) {
      luigiCookie = getLuigiCookie(cookies);
    }
    if (luigiCookie === luigiCookieValue) {
      winParent.postMessage({ msg: 'luigi.third-party-cookie', tpc }, targetOrigin);
      document.cookie = luigiCookieKey + '=; Max-Age=-99999999; SameSite=None; Secure';
    } else {
      tpc = 'disabled';
      winParent.postMessage({ msg: 'luigi.third-party-cookie', tpc }, targetOrigin);
      console.warn('Third party cookies are not supported!');
    }
  </script>
</body>
