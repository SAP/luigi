<div class="fd-app__sidebar {hideNavComponent ? 'hideNavComponent' : ''}">
    {#if children && pathData.length > 1}
        <nav class="fd-side-nav">
            {#each Object.entries(children) as [key, nodes]}
                {#if key === 'undefined'}
                    <div class="fd-side-nav__group">
                        <ul class="fd-side-nav__list">
                            {#each nodes as node}
                                {#if !node.hideFromNav}
                                {#if node.label}
                                <li class="fd-side-nav__item {node.externalLink && node.externalLink.url ? 'fd-side-nav__item--external' : ''}">
                                    <a class="fd-side-nav__link {node === selectedNode ? 'is-selected' : ''}" on:click=handleClick(node)>
                                        {node.label}
                                        {#if node.externalLink && node.externalLink.url}
                                            <span class="sap-icon--action sap-icon--s"></span>
                                        {/if}
                                    </a>

                                </li>
                                {/if}
                                {/if}
                            {/each}
                        </ul>
                    </div>
                {/if}
            {/each}
            {#each Object.entries(children) as [key, nodes]}
                {#if key !== 'undefined'}
                    <div class="fd-side-nav__group">
                        <h1 class="fd-side-nav__title">{key}</h1>
                        <ul class="fd-side-nav__list">
                            {#each nodes as node}
                                {#if !node.hideFromNav}
                                {#if node.label}
                                <li class="fd-side-nav__item {node.externalLink && node.externalLink.url ? 'fd-side-nav__item--external' : ''}">
                                    <a class="fd-side-nav__link {node === selectedNode ? 'is-selected' : ''}" on:click=handleClick(node)>
                                        {node.label}
                                        {#if node.externalLink && node.externalLink.url}
                                            <span class="sap-icon--action sap-icon--s"></span>
                                        {/if}
                                    </a>

                                </li>
                                {/if}
                                {/if}
                            {/each}
                        </ul>
                    </div>
                {/if}
            {/each}
        </nav>
    {/if}
</div>

<script type="text/javascript">
    import { getChildren, getLeftNavData } from './services/navigation.js';
    import { handleRouteClick } from '../services/routing.js';
    import { LuigiConfig } from '../services/config.js';

    const setLeftNavData = async (current, component) => {
      const componentData = component.get();
      const leftNavData = await getLeftNavData(current, componentData);
      if (!leftNavData) {
        return;
      }
      component.set(leftNavData);
      window.LEFTNAVDATA = leftNavData.groupedChildren;
    };

    export default {
      oncreate() {
        this.set({
          hideNavComponent: LuigiConfig.getConfigBooleanValue('settings.hideNavigation')
        });
      },
      onstate({ changed, current, previous }) {
        if (!previous || previous.pathData != current.pathData) {
          setLeftNavData(current, this);
        }
      },
      methods: {
        handleClick: node => handleRouteClick(node)
      }
    };
</script>

<style type="text/scss">
  a {
    cursor: pointer;
  }
  .fd-app__sidebar {
    position: fixed;
    top: 50px;
    left: 0;
    width: 320px;
    bottom: 0;
    background-color: white;
    color: #32363a;
    overflow-y: auto;
  }

  .fd-side-nav__group {
    margin-top: 20px;
  }
  .fd-side-nav__link {
    .sap-icon--action {
      margin-left: 0.3em;
      vertical-align: middle;
    }
  }

  .hideNavComponent {
    display: none;
  }
</style>
