<div
  class="fd-product-switcher__body"
  aria-hidden="{!(dropDownStates.productSwitcherPopover || false)}"
  id="productSwitcherPopover"
>
  <nav on:click="toggleDropdownState('productSwitcherPopover')">
    <ul>
      {#if items && items.length} {#each items as productSwitcherItem}
      <li on:click="onActionClick(productSwitcherItem)">
        <span class="fd-product-switcher__product-icon"
          ><img src="{productSwitcherItem.icon}"
        /></span>
        <span class="fd-product-switcher__product-title"
          >{productSwitcherItem.label}</span
        >
      </li>
      {/each} {/if}
    </ul>
  </nav>
</div>

<script type="text/javascript">
  import { LuigiConfig } from '../services/config.js';
  import * as Routing from '../services/routing.js';
  export default {
    async oncreate() {
      const productSwitcherConfig = LuigiConfig.getConfigValue(
        'navigation.productSwitcher'
      );
      this.set({
        config: productSwitcherConfig
      });

      if (productSwitcherConfig) {
        const items = await LuigiConfig.getConfigValueAsync(
          'navigation.productSwitcher.items'
        );
        this.set({
          items,
          fallbackLabelResolver: productSwitcherConfig.fallbackLabelResolver
        });
      }
    },
    methods: {
      onActionClick(productSwitcherItem) {
        if (productSwitcherItem.externalLink) {
          window.open(productSwitcherItem.externalLink.url);
        } else {
          Routing.navigateTo(productSwitcherItem.link);
        }
      },
      toggleDropdownState(name) {
        this.fire('toggleDropdownState', { name });
        const dropDownStates = this.get().dropDownStates || {};
        const isOpened = JSON.parse(dropDownStates[name]);
        if (isOpened) {
          this.fetchOptions();
        }
      }
    },
    components: {}
  };
</script>
<style type="text/scss"></style>
