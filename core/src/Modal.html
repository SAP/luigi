<div class="fd-ui__overlay fd-overlay fd-overlay--modal">
  <!--aria-hidden="false"-->
  <div class="fd-modal" data-cy="luigi-confirmation-modal">
    <div class="fd-modal__content" role="document">
      <div class="fd-modal__header">
        <h1 class="fd-modal__title">{modalSettings.title?modalSettings.title:''}</h1>
        <button
          class="fd-button--light fd-modal__close"
          on:click="fire('close')"
          aria-label="close"
        ></button>
      </div>
      <div id="iframeModalCtn"></div>
    </div>
  </div>
</div>
<script>
  import * as Navigation from './navigation/services/navigation';
  import * as RoutingHelpers from './utilities/helpers/routing-helpers';
  import { LuigiConfig } from './services/config';

  const getNode = async nodepath => {
    const pathData = await Navigation.getNavigationPath(
      LuigiConfig.getConfigValueAsync('navigation.nodes'),
      nodepath
    );
    const lastNode = RoutingHelpers.getLastNodeObject(pathData);
    createIframeModal(lastNode.viewUrl);
  };
  const createIframeModal = viewUrl => {
    const iframe = document.createElement('iframe');
    iframe.src = viewUrl;
    iframe.width = '100%';
    iframe.height = '400px';
    iframe.frameBorder = '0';
    const iframeCtn = document.getElementById('iframeModalCtn');
    iframeCtn.appendChild(iframe);
  };

  export default {
    onupdate({ changed, current, previous }) {
      this.set({ modalSettings: this.get().modalSettings });
      const nodepath = this.get().nodepath;
      const modalSettings = this.get().modalSettings;
      getNode(nodepath);
    }
  };
</script>
<style type="text/scss">
  $topNavHeight: 50px;
  $leftNavWidth: 320px;
  $width: 32rem;
  .fd-modal {
    max-width: 70%;
    width: 70%;
    height: 400px;
    &__body,
    &__header {
      overflow-wrap: break-word;
    }
  }

  .iframeModalCtn {
    height: 100%;
  }

  :global(.no-side-nav),
  :global(.no-nav) {
    .fd-modal {
      left: calc(50% - #{$width}/ 2);
    }
  }
</style>
