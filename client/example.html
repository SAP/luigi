<html>
    <head>
        <script src="luigi-client.js" ></script>
    </head>
    <body>

        <h2>URL</h2>
        <p><code id="url"></code></p>

        <h2>Context</h2>
        <p><code id="context"></code></p>

        <h2>Node Params</h2>
        <p><code id="nodeParams"></code></p>

        <h2>Navigation</h2>
        <p><label>path to go:   </label>  <input id="pathInput" type="text"> </p>
        <p>with params <input id="withParams" type="text"></p>
        <p>from a context <input id="pathMark" type="text"></p>
        <p>from the closest context <input id="pathClosestMarkCB" type="checkbox"></p>
        <p><button id="pathButton" onclick="go()">GO!</button></p>

        <script type="text/javascript">

            document.getElementById('url').innerText = window.location;

            window.Luigi.addContextUpdateListener(() => {
                console.log('yay, initialized');
                document.getElementById('context').innerText = JSON.stringify(Luigi.getEventData());
                document.getElementById('nodeParams').innerText = JSON.stringify(Luigi.getNodeParams());
            });

            go = function() {
                var to = document.getElementById('pathInput').value;
                console.log("TO: " + to);
                if (!to) {
                    return;
                }
                var withParams = document.getElementById('withParams').value;
                console.log("WITH PARAMS: " + withParams);
                var navigationMark = document.getElementById('pathMark').value;
                console.log("FROM CONTEXT: " + navigationMark);
                var closestNavigationMark = document.getElementById('pathClosestMarkCB').checked;
                console.log("FROM CLOSEST CONTEXT: " + closestNavigationMark);
                var lm = Luigi.linkManager();
                if (closestNavigationMark) {
                    lm = lm.fromClosestContext();
                } else if (navigationMark) {
                    lm = lm.fromContext(navigationMark)
                }

                if (withParams) {
                   lm = lm.withParams(JSON.parse(withParams));
                }

                lm.navigate(to, Luigi.getEventData().sessionId);
            };

            document.getElementById('pathButton').onclick = go;

        </script>

    </body>
</html>