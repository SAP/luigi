!(function(n, t) {
  'object' == typeof exports && 'object' == typeof module
    ? (module.exports = t())
    : 'function' == typeof define && define.amd
    ? define([], t)
    : 'object' == typeof exports
    ? (exports['LuigiPlugin-auth-oauth2'] = t())
    : (n['LuigiPlugin-auth-oauth2'] = t());
})(window, function() {
  return (function(n) {
    var t = {};
    function e(g) {
      if (t[g]) return t[g].exports;
      var a = (t[g] = { i: g, l: !1, exports: {} });
      return n[g].call(a.exports, a, a.exports, e), (a.l = !0), a.exports;
    }
    return (
      (e.m = n),
      (e.c = t),
      (e.d = function(n, t, g) {
        e.o(n, t) || Object.defineProperty(n, t, { enumerable: !0, get: g });
      }),
      (e.r = function(n) {
        'undefined' != typeof Symbol &&
          Symbol.toStringTag &&
          Object.defineProperty(n, Symbol.toStringTag, { value: 'Module' }),
          Object.defineProperty(n, '__esModule', { value: !0 });
      }),
      (e.t = function(n, t) {
        if ((1 & t && (n = e(n)), 8 & t)) return n;
        if (4 & t && 'object' == typeof n && n && n.__esModule) return n;
        var g = Object.create(null);
        if (
          (e.r(g),
          Object.defineProperty(g, 'default', { enumerable: !0, value: n }),
          2 & t && 'string' != typeof n)
        )
          for (var a in n)
            e.d(
              g,
              a,
              function(t) {
                return n[t];
              }.bind(null, a)
            );
        return g;
      }),
      (e.n = function(n) {
        var t =
          n && n.__esModule
            ? function() {
                return n.default;
              }
            : function() {
                return n;
              };
        return e.d(t, 'a', t), t;
      }),
      (e.o = function(n, t) {
        return Object.prototype.hasOwnProperty.call(n, t);
      }),
      (e.p = ''),
      e((e.s = 0))
    );
  })([
    /*!**********************************************!*\
  !*** ./src/auth-oauth2/index.js + 1 modules ***!
  \**********************************************/
    /*! exports provided: default */
    /*! all exports used */ function(
      module,
      __webpack_exports__,
      __webpack_require__
    ) {
      'use strict';
      eval(
        "__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./src/helpers.js\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n/** @private */\nvar HelpersClass =\n/*#__PURE__*/\nfunction () {\n  function HelpersClass() {\n    _classCallCheck(this, HelpersClass);\n  }\n  /**\n   * Creates a random Id\n   * @private\n   */\n\n\n  _createClass(HelpersClass, [{\n    key: \"getRandomId\",\n    value: function getRandomId() {\n      // window.msCrypto for IE 11\n      return (window.crypto || window.msCrypto).getRandomValues(new Uint32Array(1))[0];\n    }\n  }, {\n    key: \"isFunction\",\n    value: function isFunction(anyParam) {\n      return anyParam && {}.toString.call(anyParam) === '[object Function]';\n    }\n  }, {\n    key: \"isPromise\",\n    value: function isPromise(anyParam) {\n      return anyParam && this.isFunction(anyParam.then);\n    }\n  }, {\n    key: \"isIE\",\n    value: function isIE() {\n      var ua = navigator.userAgent;\n      /* MSIE used to detect old browsers and Trident used to newer ones*/\n\n      return Boolean(ua.includes('MSIE ') || ua.includes('Trident/'));\n    }\n    /**\n     * Simple object check.\n     * @param item mixed\n     * @returns {boolean}\n     */\n\n  }, {\n    key: \"isObject\",\n    value: function isObject(item) {\n      return item && _typeof(item) === 'object' && !Array.isArray(item);\n    }\n    /**\n     * Deep merge two objects.\n     * @param target\n     * @param ...sources\n     */\n\n  }, {\n    key: \"deepMerge\",\n    value: function deepMerge(target) {\n      for (var _len = arguments.length, sources = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        sources[_key - 1] = arguments[_key];\n      }\n\n      if (!sources.length) return target;\n      var source = sources.shift();\n\n      if (this.isObject(target) && this.isObject(source)) {\n        for (var key in source) {\n          if (this.isObject(source[key])) {\n            if (!target[key]) Object.assign(target, _defineProperty({}, key, {}));\n            this.deepMerge(target[key], source[key]);\n          } else {\n            Object.assign(target, _defineProperty({}, key, source[key]));\n          }\n        }\n      }\n\n      return this.deepMerge.apply(this, [target].concat(sources));\n    }\n    /**\n     * Prepend current url to redirect_uri, if it is a relative path\n     * @param {path} string full url, relative or absolute path\n     */\n\n  }, {\n    key: \"prependOrigin\",\n    value: function prependOrigin(path) {\n      if (path.startsWith('http')) {\n        return path;\n      }\n\n      var hasLeadingSlash = path.startsWith('/');\n\n      if (path.length) {\n        return window.location.origin + (hasLeadingSlash ? '' : '/') + path;\n      }\n\n      return window.location.origin;\n    }\n  }]);\n\n  return HelpersClass;\n}();\n\nvar Helpers = new HelpersClass();\n// CONCATENATED MODULE: ./src/auth-oauth2/index.js\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return auth_oauth2_oAuth2ImplicitGrant; });\nfunction auth_oauth2_classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction auth_oauth2_defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction auth_oauth2_createClass(Constructor, protoProps, staticProps) { if (protoProps) auth_oauth2_defineProperties(Constructor.prototype, protoProps); if (staticProps) auth_oauth2_defineProperties(Constructor, staticProps); return Constructor; }\n\n/* istanbul ignore file */\n\n\nvar auth_oauth2_oAuth2ImplicitGrant =\n/*#__PURE__*/\nfunction () {\n  function oAuth2ImplicitGrant() {\n    var settings = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    auth_oauth2_classCallCheck(this, oAuth2ImplicitGrant);\n\n    var defaultSettings = {\n      oAuthData: {\n        redirect_uri: window.location.origin + '/luigi-core/auth/oauth2/callback.html',\n        response_type: 'id_token token',\n        scope: ''\n      },\n      authorizeMethod: 'GET',\n      logoutUrl: '',\n      post_logout_redirect_uri: window.location.origin + '/logout.html',\n      accessTokenExpiringNotificationTime: 60,\n      expirationCheckInterval: 5\n    };\n    var mergedSettings = Helpers.deepMerge(defaultSettings, settings);\n    this.settings = mergedSettings;\n  }\n\n  auth_oauth2_createClass(oAuth2ImplicitGrant, [{\n    key: \"getAuthData\",\n    value: function getAuthData() {\n      return Luigi.auth().store.getAuthData();\n    }\n  }, {\n    key: \"parseIdToken\",\n    value: function parseIdToken(token) {\n      var payload = token.split('.')[1].replace(/-/g, '+').replace(/_/g, '/');\n      return JSON.parse(window.atob(payload));\n    }\n  }, {\n    key: \"userInfo\",\n    value: function userInfo() {\n      var _this = this;\n\n      return new Promise(function (resolve, reject) {\n        var authData = _this.getAuthData();\n\n        var tokenInfo = _this.parseIdToken(authData.idToken);\n\n        var userInfo = {\n          email: tokenInfo.email ? tokenInfo.email : '',\n          name: tokenInfo.name ? tokenInfo.name : ''\n        };\n        resolve(userInfo);\n      });\n    }\n  }, {\n    key: \"login\",\n    value: function login() {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        var settings = _this2.settings;\n\n        var generatedNonce = settings.nonceFn && settings.nonceFn() || _this2.generateNonce();\n\n        sessionStorage.setItem('luigi.nonceValue', generatedNonce);\n\n        if (!settings.oAuthData.nonce) {\n          settings.oAuthData.nonce = generatedNonce;\n        }\n\n        var createInputElement = function createInputElement(name, value) {\n          var inputElem = document.createElement('input');\n          inputElem.name = name;\n          inputElem.id = name;\n          inputElem.value = value;\n          inputElem.type = 'hidden';\n          return inputElem;\n        };\n\n        var formElem = document.createElement('form');\n        formElem.name = 'signIn';\n        formElem.id = 'signIn';\n        formElem.action = settings.authorizeUrl;\n        formElem.method = settings.authorizeMethod;\n        formElem.target = '_self';\n        settings.oAuthData.redirect_uri = \"\".concat(Helpers.prependOrigin(settings.oAuthData.redirect_uri), \"?storageType=\").concat(Luigi.auth().store.getStorageType());\n        settings.oAuthData.state = btoa(window.location.href + '_luigiNonce=' + generatedNonce);\n\n        for (var name in settings.oAuthData) {\n          var node = createInputElement(name, settings.oAuthData[name]);\n          formElem.appendChild(node.cloneNode());\n        }\n\n        document.getElementsByTagName('body')[0].appendChild(formElem);\n        setTimeout(function () {\n          document.querySelector('form#signIn').submit();\n        }); // TODO: We're not resolving the promise at any time,\n        // since oauth2 is redirecting off the page\n        // maybe it is possible to catch errors\n\n        document.querySelector('form#signIn').addEventListener('load', function (e) {\n          console.info('load, e', e, _this2);\n        });\n      });\n    }\n  }, {\n    key: \"logout\",\n    value: function logout(authData, authEventLogoutFn) {\n      var settings = this.settings;\n      var logouturl = \"\".concat(settings.logoutUrl, \"?id_token_hint=\").concat(authData.idToken, \"&client_id=\").concat(settings.oAuthData.client_id, \"&post_logout_redirect_uri=\").concat(Helpers.prependOrigin(settings.post_logout_redirect_uri));\n      authEventLogoutFn && authEventLogoutFn();\n      setTimeout(function () {\n        window.location.href = logouturl;\n      });\n    }\n  }, {\n    key: \"setTokenExpirationAction\",\n    value: function setTokenExpirationAction() {\n      var _this3 = this;\n\n      var expirationCheckInterval = 5000;\n      var expirationCheckIntervalInstance = setInterval(function () {\n        var authData = _this3.getAuthData();\n\n        if (!authData) {\n          return clearInterval(expirationCheckIntervalInstance);\n        }\n\n        var tokenExpirationDate = authData && authData.accessTokenExpirationDate || 0;\n        var currentDate = new Date();\n\n        if (tokenExpirationDate - currentDate < expirationCheckInterval) {\n          clearInterval(expirationCheckIntervalInstance);\n          Luigi.auth().store.removeAuthData(); // TODO: check if valid (mock-auth requires it), post_logout_redirect_uri is an assumption, might not be available for all auth providers\n\n          var redirectUrl = \"\".concat(_this3.settings.logoutUrl, \"?error=tokenExpired&post_logout_redirect_uri=\").concat(Helpers.prependOrigin(_this3.settings.post_logout_redirect_uri));\n          Luigi.auth().handleAuthEvent('onAuthExpired', _this3.settings, undefined, redirectUrl);\n        }\n      }, expirationCheckInterval);\n    }\n  }, {\n    key: \"setTokenExpireSoonAction\",\n    value: function setTokenExpireSoonAction() {\n      var _this4 = this;\n\n      var accessTokenExpiringNotificationTime = this.settings.accessTokenExpiringNotificationTime * 1000;\n      var expirationCheckInterval = this.settings.expirationCheckInterval * 1000;\n      var authData = this.getAuthData();\n\n      if (authData) {\n        var expirationCheckIntervalInstance = setInterval(function () {\n          var tokenExpirationDate = authData && authData.accessTokenExpirationDate || 0;\n          var currentDate = new Date();\n\n          if (tokenExpirationDate - currentDate.getTime() < accessTokenExpiringNotificationTime) {\n            Luigi.auth().handleAuthEvent('onAuthExpireSoon', _this4.settings);\n            clearInterval(expirationCheckIntervalInstance);\n          }\n        }, expirationCheckInterval);\n      }\n    }\n  }, {\n    key: \"generateNonce\",\n    value: function generateNonce() {\n      var validChars = '0123456789ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvwxyz';\n      var crypto = window.crypto || window.msCrypto;\n      var random = Array.from(crypto.getRandomValues(new Uint8Array(20)));\n      return random.map(function (x) {\n        return validChars[x % validChars.length];\n      }).join('');\n    }\n  }]);\n\n  return oAuth2ImplicitGrant;\n}();\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovL0x1aWdpUGx1Z2luLVtuYW1lXS8uL3NyYy9oZWxwZXJzLmpzP2Q3YzIiLCJ3ZWJwYWNrOi8vTHVpZ2lQbHVnaW4tW25hbWVdLy4vc3JjL2F1dGgtb2F1dGgyL2luZGV4LmpzPzUyMmQiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqIEBwcml2YXRlICovXG5jbGFzcyBIZWxwZXJzQ2xhc3Mge1xuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSByYW5kb20gSWRcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGdldFJhbmRvbUlkKCkge1xuICAgIC8vIHdpbmRvdy5tc0NyeXB0byBmb3IgSUUgMTFcbiAgICByZXR1cm4gKHdpbmRvdy5jcnlwdG8gfHwgd2luZG93Lm1zQ3J5cHRvKS5nZXRSYW5kb21WYWx1ZXMoXG4gICAgICBuZXcgVWludDMyQXJyYXkoMSlcbiAgICApWzBdO1xuICB9XG4gIFxuICBpc0Z1bmN0aW9uKGFueVBhcmFtKSB7XG4gICAgcmV0dXJuIGFueVBhcmFtICYmIHt9LnRvU3RyaW5nLmNhbGwoYW55UGFyYW0pID09PSAnW29iamVjdCBGdW5jdGlvbl0nO1xuICB9XG5cbiAgaXNQcm9taXNlKGFueVBhcmFtKSB7XG4gICAgcmV0dXJuIGFueVBhcmFtICYmIHRoaXMuaXNGdW5jdGlvbihhbnlQYXJhbS50aGVuKTtcbiAgfVxuXG4gIGlzSUUoKSB7XG4gICAgY29uc3QgdWEgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xuICAgIC8qIE1TSUUgdXNlZCB0byBkZXRlY3Qgb2xkIGJyb3dzZXJzIGFuZCBUcmlkZW50IHVzZWQgdG8gbmV3ZXIgb25lcyovXG4gICAgcmV0dXJuIEJvb2xlYW4odWEuaW5jbHVkZXMoJ01TSUUgJykgfHwgdWEuaW5jbHVkZXMoJ1RyaWRlbnQvJykpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNpbXBsZSBvYmplY3QgY2hlY2suXG4gICAqIEBwYXJhbSBpdGVtIG1peGVkXG4gICAqIEByZXR1cm5zIHtib29sZWFufVxuICAgKi9cbiAgaXNPYmplY3QoaXRlbSkge1xuICAgIHJldHVybiBpdGVtICYmIHR5cGVvZiBpdGVtID09PSAnb2JqZWN0JyAmJiAhQXJyYXkuaXNBcnJheShpdGVtKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWVwIG1lcmdlIHR3byBvYmplY3RzLlxuICAgKiBAcGFyYW0gdGFyZ2V0XG4gICAqIEBwYXJhbSAuLi5zb3VyY2VzXG4gICAqL1xuICBkZWVwTWVyZ2UodGFyZ2V0LCAuLi5zb3VyY2VzKSB7XG4gICAgaWYgKCFzb3VyY2VzLmxlbmd0aCkgcmV0dXJuIHRhcmdldDtcbiAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzLnNoaWZ0KCk7XG5cbiAgICBpZiAodGhpcy5pc09iamVjdCh0YXJnZXQpICYmIHRoaXMuaXNPYmplY3Qoc291cmNlKSkge1xuICAgICAgZm9yIChjb25zdCBrZXkgaW4gc291cmNlKSB7XG4gICAgICAgIGlmICh0aGlzLmlzT2JqZWN0KHNvdXJjZVtrZXldKSkge1xuICAgICAgICAgIGlmICghdGFyZ2V0W2tleV0pIE9iamVjdC5hc3NpZ24odGFyZ2V0LCB7IFtrZXldOiB7fSB9KTtcbiAgICAgICAgICB0aGlzLmRlZXBNZXJnZSh0YXJnZXRba2V5XSwgc291cmNlW2tleV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIE9iamVjdC5hc3NpZ24odGFyZ2V0LCB7IFtrZXldOiBzb3VyY2Vba2V5XSB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmRlZXBNZXJnZSh0YXJnZXQsIC4uLnNvdXJjZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFByZXBlbmQgY3VycmVudCB1cmwgdG8gcmVkaXJlY3RfdXJpLCBpZiBpdCBpcyBhIHJlbGF0aXZlIHBhdGhcbiAgICogQHBhcmFtIHtwYXRofSBzdHJpbmcgZnVsbCB1cmwsIHJlbGF0aXZlIG9yIGFic29sdXRlIHBhdGhcbiAgICovXG4gIHByZXBlbmRPcmlnaW4ocGF0aCkge1xuICAgIGlmIChwYXRoLnN0YXJ0c1dpdGgoJ2h0dHAnKSkge1xuICAgICAgcmV0dXJuIHBhdGg7XG4gICAgfVxuICAgIGNvbnN0IGhhc0xlYWRpbmdTbGFzaCA9IHBhdGguc3RhcnRzV2l0aCgnLycpO1xuICAgIGlmIChwYXRoLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gKyAoaGFzTGVhZGluZ1NsYXNoID8gJycgOiAnLycpICsgcGF0aDtcbiAgICB9XG4gICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW47XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IEhlbHBlcnMgPSBuZXcgSGVscGVyc0NsYXNzKCk7XG4iLCIvKiBpc3RhbmJ1bCBpZ25vcmUgZmlsZSAqL1xuaW1wb3J0IHsgSGVscGVycyB9IGZyb20gJy4uL2hlbHBlcnMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBvQXV0aDJJbXBsaWNpdEdyYW50IHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MgPSB7fSkge1xuICAgIGNvbnN0IGRlZmF1bHRTZXR0aW5ncyA9IHtcbiAgICAgIG9BdXRoRGF0YToge1xuICAgICAgICByZWRpcmVjdF91cmk6XG4gICAgICAgICAgd2luZG93LmxvY2F0aW9uLm9yaWdpbiArICcvbHVpZ2ktY29yZS9hdXRoL29hdXRoMi9jYWxsYmFjay5odG1sJyxcbiAgICAgICAgcmVzcG9uc2VfdHlwZTogJ2lkX3Rva2VuIHRva2VuJyxcbiAgICAgICAgc2NvcGU6ICcnXG4gICAgICB9LFxuICAgICAgYXV0aG9yaXplTWV0aG9kOiAnR0VUJyxcbiAgICAgIGxvZ291dFVybDogJycsXG4gICAgICBwb3N0X2xvZ291dF9yZWRpcmVjdF91cmk6IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gKyAnL2xvZ291dC5odG1sJyxcbiAgICAgIGFjY2Vzc1Rva2VuRXhwaXJpbmdOb3RpZmljYXRpb25UaW1lOiA2MCxcbiAgICAgIGV4cGlyYXRpb25DaGVja0ludGVydmFsOiA1XG4gICAgfTtcbiAgICBjb25zdCBtZXJnZWRTZXR0aW5ncyA9IEhlbHBlcnMuZGVlcE1lcmdlKGRlZmF1bHRTZXR0aW5ncywgc2V0dGluZ3MpO1xuXG4gICAgdGhpcy5zZXR0aW5ncyA9IG1lcmdlZFNldHRpbmdzO1xuICB9XG5cbiAgZ2V0QXV0aERhdGEoKSB7XG4gICAgcmV0dXJuIEx1aWdpLmF1dGgoKS5zdG9yZS5nZXRBdXRoRGF0YSgpO1xuICB9XG5cbiAgcGFyc2VJZFRva2VuKHRva2VuKSB7XG4gICAgY29uc3QgcGF5bG9hZCA9IHRva2VuXG4gICAgICAuc3BsaXQoJy4nKVsxXVxuICAgICAgLnJlcGxhY2UoLy0vZywgJysnKVxuICAgICAgLnJlcGxhY2UoL18vZywgJy8nKTtcbiAgICByZXR1cm4gSlNPTi5wYXJzZSh3aW5kb3cuYXRvYihwYXlsb2FkKSk7XG4gIH1cblxuICB1c2VySW5mbygpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgbGV0IGF1dGhEYXRhID0gdGhpcy5nZXRBdXRoRGF0YSgpO1xuICAgICAgY29uc3QgdG9rZW5JbmZvID0gdGhpcy5wYXJzZUlkVG9rZW4oYXV0aERhdGEuaWRUb2tlbik7XG4gICAgICBjb25zdCB1c2VySW5mbyA9IHtcbiAgICAgICAgZW1haWw6IHRva2VuSW5mby5lbWFpbCA/IHRva2VuSW5mby5lbWFpbCA6ICcnLFxuICAgICAgICBuYW1lOiB0b2tlbkluZm8ubmFtZSA/IHRva2VuSW5mby5uYW1lIDogJydcbiAgICAgIH07XG4gICAgICByZXNvbHZlKHVzZXJJbmZvKTtcbiAgICB9KTtcbiAgfVxuXG4gIGxvZ2luKCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCBzZXR0aW5ncyA9IHRoaXMuc2V0dGluZ3M7XG4gICAgICBjb25zdCBnZW5lcmF0ZWROb25jZSA9XG4gICAgICAgIChzZXR0aW5ncy5ub25jZUZuICYmIHNldHRpbmdzLm5vbmNlRm4oKSkgfHwgdGhpcy5nZW5lcmF0ZU5vbmNlKCk7XG4gICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdsdWlnaS5ub25jZVZhbHVlJywgZ2VuZXJhdGVkTm9uY2UpO1xuICAgICAgaWYgKCFzZXR0aW5ncy5vQXV0aERhdGEubm9uY2UpIHtcbiAgICAgICAgc2V0dGluZ3Mub0F1dGhEYXRhLm5vbmNlID0gZ2VuZXJhdGVkTm9uY2U7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNyZWF0ZUlucHV0RWxlbWVudCA9IChuYW1lLCB2YWx1ZSkgPT4ge1xuICAgICAgICBjb25zdCBpbnB1dEVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgICAgICBpbnB1dEVsZW0ubmFtZSA9IG5hbWU7XG4gICAgICAgIGlucHV0RWxlbS5pZCA9IG5hbWU7XG4gICAgICAgIGlucHV0RWxlbS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICBpbnB1dEVsZW0udHlwZSA9ICdoaWRkZW4nO1xuICAgICAgICByZXR1cm4gaW5wdXRFbGVtO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgZm9ybUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmb3JtJyk7XG4gICAgICBmb3JtRWxlbS5uYW1lID0gJ3NpZ25Jbic7XG4gICAgICBmb3JtRWxlbS5pZCA9ICdzaWduSW4nO1xuICAgICAgZm9ybUVsZW0uYWN0aW9uID0gc2V0dGluZ3MuYXV0aG9yaXplVXJsO1xuICAgICAgZm9ybUVsZW0ubWV0aG9kID0gc2V0dGluZ3MuYXV0aG9yaXplTWV0aG9kO1xuICAgICAgZm9ybUVsZW0udGFyZ2V0ID0gJ19zZWxmJztcblxuICAgICAgc2V0dGluZ3Mub0F1dGhEYXRhLnJlZGlyZWN0X3VyaSA9IGAke0hlbHBlcnMucHJlcGVuZE9yaWdpbihcbiAgICAgICAgc2V0dGluZ3Mub0F1dGhEYXRhLnJlZGlyZWN0X3VyaVxuICAgICAgKX0/c3RvcmFnZVR5cGU9JHtMdWlnaS5hdXRoKCkuc3RvcmUuZ2V0U3RvcmFnZVR5cGUoKX1gO1xuICAgICAgc2V0dGluZ3Mub0F1dGhEYXRhLnN0YXRlID0gYnRvYShcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgKyAnX2x1aWdpTm9uY2U9JyArIGdlbmVyYXRlZE5vbmNlXG4gICAgICApO1xuXG4gICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gc2V0dGluZ3Mub0F1dGhEYXRhKSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBjcmVhdGVJbnB1dEVsZW1lbnQobmFtZSwgc2V0dGluZ3Mub0F1dGhEYXRhW25hbWVdKTtcbiAgICAgICAgZm9ybUVsZW0uYXBwZW5kQ2hpbGQobm9kZS5jbG9uZU5vZGUoKSk7XG4gICAgICB9XG5cbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF0uYXBwZW5kQ2hpbGQoZm9ybUVsZW0pO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm0jc2lnbkluJykuc3VibWl0KCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gVE9ETzogV2UncmUgbm90IHJlc29sdmluZyB0aGUgcHJvbWlzZSBhdCBhbnkgdGltZSxcbiAgICAgIC8vIHNpbmNlIG9hdXRoMiBpcyByZWRpcmVjdGluZyBvZmYgdGhlIHBhZ2VcbiAgICAgIC8vIG1heWJlIGl0IGlzIHBvc3NpYmxlIHRvIGNhdGNoIGVycm9yc1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZm9ybSNzaWduSW4nKS5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZSA9PiB7XG4gICAgICAgIGNvbnNvbGUuaW5mbygnbG9hZCwgZScsIGUsIHRoaXMpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBsb2dvdXQoYXV0aERhdGEsIGF1dGhFdmVudExvZ291dEZuKSB7XG4gICAgY29uc3Qgc2V0dGluZ3MgPSB0aGlzLnNldHRpbmdzO1xuICAgIGNvbnN0IGxvZ291dHVybCA9IGAke3NldHRpbmdzLmxvZ291dFVybH0/aWRfdG9rZW5faGludD0ke1xuICAgICAgYXV0aERhdGEuaWRUb2tlblxuICAgIH0mY2xpZW50X2lkPSR7XG4gICAgICBzZXR0aW5ncy5vQXV0aERhdGEuY2xpZW50X2lkXG4gICAgfSZwb3N0X2xvZ291dF9yZWRpcmVjdF91cmk9JHtIZWxwZXJzLnByZXBlbmRPcmlnaW4oXG4gICAgICBzZXR0aW5ncy5wb3N0X2xvZ291dF9yZWRpcmVjdF91cmlcbiAgICApfWA7XG4gICAgYXV0aEV2ZW50TG9nb3V0Rm4gJiYgYXV0aEV2ZW50TG9nb3V0Rm4oKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBsb2dvdXR1cmw7XG4gICAgfSk7XG4gIH1cblxuICBzZXRUb2tlbkV4cGlyYXRpb25BY3Rpb24oKSB7XG4gICAgY29uc3QgZXhwaXJhdGlvbkNoZWNrSW50ZXJ2YWwgPSA1MDAwO1xuICAgIGNvbnN0IGV4cGlyYXRpb25DaGVja0ludGVydmFsSW5zdGFuY2UgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICBsZXQgYXV0aERhdGEgPSB0aGlzLmdldEF1dGhEYXRhKCk7XG4gICAgICBpZiAoIWF1dGhEYXRhKSB7XG4gICAgICAgIHJldHVybiBjbGVhckludGVydmFsKGV4cGlyYXRpb25DaGVja0ludGVydmFsSW5zdGFuY2UpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0b2tlbkV4cGlyYXRpb25EYXRlID1cbiAgICAgICAgKGF1dGhEYXRhICYmIGF1dGhEYXRhLmFjY2Vzc1Rva2VuRXhwaXJhdGlvbkRhdGUpIHx8IDA7XG4gICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICBpZiAodG9rZW5FeHBpcmF0aW9uRGF0ZSAtIGN1cnJlbnREYXRlIDwgZXhwaXJhdGlvbkNoZWNrSW50ZXJ2YWwpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChleHBpcmF0aW9uQ2hlY2tJbnRlcnZhbEluc3RhbmNlKTtcbiAgICAgICAgTHVpZ2kuYXV0aCgpLnN0b3JlLnJlbW92ZUF1dGhEYXRhKCk7XG4gICAgICAgIC8vIFRPRE86IGNoZWNrIGlmIHZhbGlkIChtb2NrLWF1dGggcmVxdWlyZXMgaXQpLCBwb3N0X2xvZ291dF9yZWRpcmVjdF91cmkgaXMgYW4gYXNzdW1wdGlvbiwgbWlnaHQgbm90IGJlIGF2YWlsYWJsZSBmb3IgYWxsIGF1dGggcHJvdmlkZXJzXG4gICAgICAgIGNvbnN0IHJlZGlyZWN0VXJsID0gYCR7XG4gICAgICAgICAgdGhpcy5zZXR0aW5ncy5sb2dvdXRVcmxcbiAgICAgICAgfT9lcnJvcj10b2tlbkV4cGlyZWQmcG9zdF9sb2dvdXRfcmVkaXJlY3RfdXJpPSR7SGVscGVycy5wcmVwZW5kT3JpZ2luKFxuICAgICAgICAgIHRoaXMuc2V0dGluZ3MucG9zdF9sb2dvdXRfcmVkaXJlY3RfdXJpXG4gICAgICAgICl9YDtcbiAgICAgICAgTHVpZ2kuYXV0aCgpLmhhbmRsZUF1dGhFdmVudChcbiAgICAgICAgICAnb25BdXRoRXhwaXJlZCcsXG4gICAgICAgICAgdGhpcy5zZXR0aW5ncyxcbiAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgcmVkaXJlY3RVcmxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LCBleHBpcmF0aW9uQ2hlY2tJbnRlcnZhbCk7XG4gIH1cblxuICBzZXRUb2tlbkV4cGlyZVNvb25BY3Rpb24oKSB7XG4gICAgY29uc3QgYWNjZXNzVG9rZW5FeHBpcmluZ05vdGlmaWNhdGlvblRpbWUgPVxuICAgICAgdGhpcy5zZXR0aW5ncy5hY2Nlc3NUb2tlbkV4cGlyaW5nTm90aWZpY2F0aW9uVGltZSAqIDEwMDA7XG4gICAgY29uc3QgZXhwaXJhdGlvbkNoZWNrSW50ZXJ2YWwgPVxuICAgICAgdGhpcy5zZXR0aW5ncy5leHBpcmF0aW9uQ2hlY2tJbnRlcnZhbCAqIDEwMDA7XG4gICAgbGV0IGF1dGhEYXRhID0gdGhpcy5nZXRBdXRoRGF0YSgpO1xuICAgIGlmIChhdXRoRGF0YSkge1xuICAgICAgY29uc3QgZXhwaXJhdGlvbkNoZWNrSW50ZXJ2YWxJbnN0YW5jZSA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgY29uc3QgdG9rZW5FeHBpcmF0aW9uRGF0ZSA9XG4gICAgICAgICAgKGF1dGhEYXRhICYmIGF1dGhEYXRhLmFjY2Vzc1Rva2VuRXhwaXJhdGlvbkRhdGUpIHx8IDA7XG4gICAgICAgIGNvbnN0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHRva2VuRXhwaXJhdGlvbkRhdGUgLSBjdXJyZW50RGF0ZS5nZXRUaW1lKCkgPFxuICAgICAgICAgIGFjY2Vzc1Rva2VuRXhwaXJpbmdOb3RpZmljYXRpb25UaW1lXG4gICAgICAgICkge1xuICAgICAgICAgIEx1aWdpLmF1dGgoKS5oYW5kbGVBdXRoRXZlbnQoJ29uQXV0aEV4cGlyZVNvb24nLCB0aGlzLnNldHRpbmdzKTtcbiAgICAgICAgICBjbGVhckludGVydmFsKGV4cGlyYXRpb25DaGVja0ludGVydmFsSW5zdGFuY2UpO1xuICAgICAgICB9XG4gICAgICB9LCBleHBpcmF0aW9uQ2hlY2tJbnRlcnZhbCk7XG4gICAgfVxuICB9XG5cbiAgZ2VuZXJhdGVOb25jZSgpIHtcbiAgICBjb25zdCB2YWxpZENoYXJzID1cbiAgICAgICcwMTIzNDU2Nzg5QUJDREVGR0hJSktMTU5PUFFSU1RVVlhZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JztcblxuICAgIGNvbnN0IGNyeXB0byA9IHdpbmRvdy5jcnlwdG8gfHwgd2luZG93Lm1zQ3J5cHRvO1xuICAgIGNvbnN0IHJhbmRvbSA9IEFycmF5LmZyb20oY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheSgyMCkpKTtcblxuICAgIHJldHVybiByYW5kb20ubWFwKHggPT4gdmFsaWRDaGFyc1t4ICUgdmFsaWRDaGFycy5sZW5ndGhdKS5qb2luKCcnKTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTs7O0FBQ0E7QUFBQTtBQUFBO0FBRUE7Ozs7Ozs7O0FBSUE7QUFDQTtBQUNBO0FBR0E7OztBQUVBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTs7Ozs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7Ozs7QUFLQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBOzs7Ozs7QUFHQTs7Ozs7Ozs7O0FDN0VBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVhBO0FBYUE7QUFFQTtBQUNBO0FBQ0E7OztBQUNBO0FBQ0E7QUFDQTs7O0FBRUE7QUFDQTtBQUlBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTs7O0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQ0E7QUFDQTtBQU9BO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFNQTtBQUNBO0FBQ0E7OztBQUVBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBOzs7Ozs7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n"
      );
    }
  ]).default;
});
