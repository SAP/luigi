<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1"
    />
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' *; img-src https://*; child-src 'none';"> -->
    <link rel="stylesheet" type="text/css" href="index.css" media="screen" />
  </head>

  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <script src="node_modules/@luigi-project/client/luigi-client.js"></script>
    <script>
      let myUserSettings = {};
      window.LuigiClient.addInitListener((context, origin) => {
        renderData(context);

        if (context && context.userSettingsData && context.userSettingsData.theme) {
          document.querySelector(
            '#currentTheme'
          ).innerHTML = `Fiori3 ${context.userSettingsData.theme}`;
        }
      });

      window.LuigiClient.addContextUpdateListener((context, origin) => {
        renderData(context);
      });

      function renderData(context) {
        myUserSettings = context.userSettingsData;
        if (myUserSettings && myUserSettings.theme) {
          let button = document.querySelector('.' + myUserSettings.theme);
          button.classList.add('active');
        }
      }

      function changeTheming(theme) {
        document.querySelectorAll('.btnList button').forEach(button => {
          button.classList.remove('active');
        });
        document.querySelector('.' + theme).classList.add('active');
        myUserSettings.theme = theme;
        window.LuigiClient.sendCustomMessage({
          id: 'luigi.updateUserSettings',
          data: myUserSettings
        });

        checkCurrentTheme();
      }

      function setYellowTheme(theme) {
        window.LuigiClient.sendCustomMessage({
          id: 'my-custom-message.update-user-settings',
          theme: 'yellow'
        });

        checkCurrentTheme();
      }

      function checkCurrentTheme() {
        const context = window.LuigiClient.getContext();

        if (context && context.userSettingsData && context.userSettingsData.theme) {
          document.querySelector(
            '#currentTheme'
          ).innerHTML = `Fiori3 ${context.userSettingsData.theme}`;
        }
      }

      checkCurrentTheme();
    </script>
    <div>
      <ul class="btnList">
        <li>
          <button class="light" style="color:#cccccc" onclick="changeTheming('light')">
            Light
          </button>
        </li>
        <br /><br />
        <li>
          <button class="dark" style="color: #000000" onclick="changeTheming('dark')">
            Dark
          </button>
        </li>
        <br /><br />
        <li>
          <button
            class="yellow"
            data-testid="yellowBtn"
            onclick="setYellowTheme('yellow')"
          >
            Yellow
          </button>
        </li>
      </ul>
      <p>Current Theme is <span id="currentTheme"></span></p>
    </div>
  </body>
</html>
