<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Luigi Simple Dev</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/@luigi-project/core@1.25.1/luigi.css"
    />
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1"
    />
    <link
      id="_theme"
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@sap-theming/theming-base-content@11.1.34/content/Base/baseLib/sap_fiori_3/css_variables.css"
    />
  </head>

  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <script src="https://unpkg.com/@luigi-project/core@1.25.1/luigi.js"></script>
    <script>
      Luigi.setConfig({
        navigation: {
          nodes: [
            {
              pathSegment: 'home',
              label: 'Home',
              loadingIndicator: {
                enabled: false
              },
              viewUrl: '/microfrontend.html'
            }
          ],
          profile: {
            logout: {
              label: 'Sign Out',
              icon: 'sys-cancel'
            }
          }
        },
        settings: {
          theming: {
            themes: [
              { id: 'sap_fiori_3', name: 'Quartz light' },
              { id: 'sap_fiori_3_dark', name: 'Quartz dark' },
              { id: 'sap_fiori_3_hcw', name: 'High Contrast White' },
              { id: 'sap_fiori_3_hcb', name: 'High Contrast Black' }
            ],
            defaultTheme: 'sap_fiori_3'
          }
        },

        lifecycleHooks: {
          luigiAfterInit: () => {
            const storedTheme = JSON.parse(sessionStorage.getItem('myUserSettings')).theme
              .theme;
            if (storedTheme) {
              const themeTag = document.querySelector('#_theme');
              themeTag.href = themeTag.href.replace('sap_fiori_3', storedTheme);
              Luigi.theming().setCurrentTheme(storedTheme);
            }
          }
        },
        userSettings: {
          userSettingGroups: {
            theme: {
              label: 'Theming',
              title: 'Theming',
              icon: 'light',
              settings: {
                theme: {
                  type: 'enum',
                  label: 'Theming',
                  options: [
                    { value: 'sap_fiori_3', label: 'Quartz light' },
                    { value: 'sap_fiori_3_dark', label: 'Quartz dark' },
                    { value: 'sap_fiori_3_hcw', label: 'High Contrast White' },
                    { value: 'sap_fiori_3_hcb', label: 'High Contrast Black' }
                  ]
                }
              }
            }
          },
          storeUserSettings: (obj, previous) => {
            return new Promise((resolve, reject) => {
              if (JSON.stringify(obj) !== JSON.stringify(previous)) {
                let theme = obj.theme.theme;
                sessionStorage.setItem('myUserSettings', JSON.stringify(obj));
                const themeTag = document.querySelector('#_theme');
                themeTag.href = themeTag.href.replace(
                  Luigi.theming().getCurrentTheme(),
                  theme
                );
                Luigi.theming().setCurrentTheme(theme);
                resolve();
              }
            });
          },
          readUserSettings: () => {
            return new Promise((resolve, reject) => {
              try {
                if (sessionStorage.getItem('myUserSettings')) {
                  resolve(JSON.parse(sessionStorage.getItem('myUserSettings')));
                } else {
                  resolve(JSON.parse(sessionStorage.getItem('myUserSettings')));
                }
              } catch {
                reject({ closeDialog: true, message: 'some error' });
              }
            });
          }
        }
      });
    </script>
  </body>
</html>
